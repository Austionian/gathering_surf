!function(){"use strict";function e(e){if(null==e)throw"item is null or undefined";return e}function t(t,a){e(document.getElementById(t)).innerText=a}function a(e,t){!function(e,t,a){document.getElementById(e)?.setAttribute(t,a)}(e,"style",t)}function n(e){document.querySelectorAll(e).forEach((e=>e.remove()))}function i(e){document.getElementById(e)?.remove()}function o(e,t){document.getElementById(e)?.classList.remove(t)}function l(e){o(e,"hidden")}const s=document.querySelector("body");new MutationObserver((e=>{for(const i of e)if("latest-data"===i.target.id&&c(JSON.parse(i.target.innerText)),"water-quality-data"===i.target.id&&(l(`current-water-quality-${(a=JSON.parse(i.target.innerText)).water_quality.toLowerCase()}`),t(`current-water-quality-${a.water_quality.toLowerCase()}-status-text`,a.water_quality_text),n(".water-quality-loader")),"forecast-data"===i.target.id)try{I(JSON.parse(i.target.innerText))}catch{console.log("failed to parse forecast, trying again."),setTimeout((()=>{I(JSON.parse(i.target.innerText))}),100)}var a})).observe(s,{attributes:!0,childList:!0,subtree:!0});const r="#a8a29e",d={"#0bd674":"Good","#ffcd1e":"Fair to Good","#ff9500":"Poor","#f4496d":"Very Poor","#a8a29e":"Flat"};function c(s){s.wave_height&&(t("current-wave-height",s.wave_height),a("wave-icon",`transform: rotate(${s.wave_direction}deg);`),n(".wavey")),s.wave_period&&(t("current-wave-period",s.wave_period),i("wavey-period-loader")),(""===e(document.getElementById("wave-quality-text")).innerText||s.wave_height||parseFloat(e(document.getElementById("current-wave-height")).innerText??"0")>=1)&&(a("wave-quality",`background-color: ${s.quality_color};`),t("wave-quality-text",s.quality_text),a("wave-quality-text",`color: ${s.quality_color}`),n(".wave-quality-loader")),t("current-water-temp",s.water_temp),t("current-air-temp",s.air_temp),t("current-air-temp-2",s.air_temp),t("wind",u(s)),t("as-of",`As of ${s.as_of}`),a("wind-icon",`transform: rotate(${s.wind_direction+180}deg);`),n(".latest-loader"),l("wind-icon-container"),l("wave-icon-container"),o("as-of-container","animate-pulse"),l("wave-quality")}const u=e=>e.wind_speed===e.gusts||"0"===e.gusts?e.wind_speed:`${e.wind_speed}-${e.gusts}`;let g,p,m,w,f,v,y,h,x,_,b,E,A;function I(s){h=s.graph_max;const c=new Date(s.starting_at).getHours();if(c>20){let e=24-c;const t=p-(p-e)%24;p=s.wave_height_labels.slice(e,t),g=s.qualities.slice(e,t),m=s.wave_height_data.slice(e,t),w=s.wind_speed_data.slice(e,t),f=s.wind_direction_data.slice(e,t),v=s.wind_gust_data.slice(e,t),y=s.wave_period_data.slice(e,t),x=s.temperature.slice(e,t),_=s.dewpoint.slice(e,t),b=s.cloud_cover.slice(e,t),E=s.probability_of_precipitation.slice(e,t),A=s.probability_of_thunder.slice(e,t)}else{const e=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(s.starting_at).getDay()],t=[`${e} 12 AM`];for(let a=1;a<c;a++)a<10&&t.push(`${e} 0${a} AM`),a>=10&&a<12&&t.push(`${e} ${a} AM`),12===a&&t.push(`${e} ${a} PM`),a>12&&t.push(`${e} 0${a-12} PM`);const a=s.wave_height_labels.length+c-(s.wave_height_labels.length+c)%24;p=t.concat(s.wave_height_labels).slice(0,a),g=new Array(c).fill("#a8a29e").concat(s.qualities).slice(0,a),m=new Array(c).fill(0).concat(s.wave_height_data).slice(0,a),w=new Array(c).fill(0).concat(s.wind_speed_data).slice(0,a),f=new Array(c).fill(0).concat(s.wind_direction_data).slice(0,a),v=new Array(c).fill(0).concat(s.wind_gust_data).slice(0,a),y=new Array(c).fill(0).concat(s.wave_period_data).slice(0,a),x=new Array(c).fill(0).concat(s.temperature).slice(0,a),_=new Array(c).fill(0).concat(s.dewpoint).slice(0,a),b=new Array(c).fill(0).concat(s.cloud_cover).slice(0,a),E=new Array(c).fill(0).concat(s.probability_of_precipitation).slice(0,a),A=new Array(c).fill(0).concat(s.probability_of_thunder).slice(0,a)}let u=(new Date).getHours();const I=new Date(s.starting_at).getHours();u=u<0?(new Date).getHours():u;const $=document.getElementById("current-wave-height");""===$?.innerText&&($.innerText=s.current_wave_height,"0"==s.current_wave_height&&(a("wave-quality",`background-color: ${r}`),t("wave-quality-text",d[r]),a("wave-quality-text",`color: ${r}`),n(".wave-quality-loader")),a("wave-icon",`transform: rotate(${s.current_wave_direction}deg);`),n(".wavey"));const q=document.getElementById("current-wave-period");""===q?.innerText&&(q.innerText=s.current_wave_period,i("wavey-period-loader")),t("legend-label",p[u]),t("legend-quality",d[g[u]]),t("legend-wave-height",m[u]),t("legend-wind-speed",w[u]),a("legend-wind-icon",`transform: rotate(${f[u]}deg);`),t("legend-wave-period",y[u]),t("legend-wind-gust",v[u]),t("forecast-as-of",`Updated @ ${s.forecast_as_of}`),t("forecast-as-of-2",`Forecast Last Ran @ ${s.forecast_as_of}`),n(".loader"),l("forecast"),l("wave-quality"),l("legend-container"),o("forecast-as-of-container","animate-pulse"),o("forecast-as-of-container-2","animate-pulse"),l("temperature-legend-container"),t("temperature-legend-label",p[u]),t("temperature-legend-temperature",x[u]),t("temperature-legend-dewpoint",_[u]),l("precipitation-legend-container"),t("precipitation-legend-label",p[u]),t("precipitation-legend-precipitation",E[u]),t("precipitation-legend-thunder",A[u]),t("precipitation-legend-cloud-cover",b[u]),a("legend",`background-color: ${g[u]};`);const k=document.getElementById("forecast"),T={id:"vert",defaults:{width:1,dash:[3,3]},afterInit:(e,t,a)=>{e.corsair={x:0,y:0}},afterDraw:(e,t,a)=>{if(e.tooltip?._active?.length){let t=e.tooltip._active[0].element.x,n=e.scales.y,i=e.ctx;i.save(),i.beginPath(),i.moveTo(t,n.top),i.lineTo(t,n.bottom),i.lineWidth=1,i.setLineDash(a.dash),i.strokeStyle="#fff",i.stroke(),i.restore()}if(u-I>C){const t=e.ctx,a=e.scales.x.getPixelForValue(u-I);t.save(),t.strokeStyle="#3b3b42",t.lineWidth=1,t.beginPath(),t.moveTo(a,0),t.lineTo(a,e.height),t.stroke(),t.fillStyle="#3b3b42",t.font="bold 1rem ui-sans-serif, system-ui, sans-serif",t.fillText("Now",u-u>14?a-45:a+5,15),t.restore()}}};function B(e){const n=0===C?I:C,i=g[e+C];a("legend",`background-color: ${i}`),t("legend-label",p[e+n]),t("legend-quality",d[i]),t("legend-wave-height",m[e+n]),t("legend-wind-speed",w[e+n]),a("legend-wind-icon",`transform: rotate(${f[e+n]}deg);`),t("legend-wave-period",y[e+n]),t("legend-wind-gust",v[e+n]),t("temperature-legend-label",p[e+n]),t("temperature-legend-temperature",x[e+n]),t("temperature-legend-dewpoint",_[e+n]),t("precipitation-legend-label",p[e+n]),t("precipitation-legend-precipitation",E[e+n]),t("precipitation-legend-thunder",A[e+n]),t("precipitation-legend-cloud-cover",b[e+n])}const S=(e,t,a)=>{const n=Chart.helpers.getRelativePosition(e,a),i=function(e){return 24===M||48===M?e&&e>0?e>=m.length-C?m.length-C-1:e:0:e&&e>0?e>=m.length?m.length-1:e:0}(a.scales.x.getValueForPixel(n.x));B(i)},F=(e,t,a)=>{const n=0===C?I:C;return 24===M?t%6==0?p[t+n]:null:48===M?t%8==0?p[t+n]:null:t%24==0?p[t+n]:null};const L=()=>window.innerWidth<768?24:window.innerWidth<1024?48:m.length;let M=L(),C=0,D=C+M;const P={size:24===M?14:18,weight:24===M?"lighter":"semi-bold"},H=new Chart(k,{type:"bar",plugins:[T],data:{labels:0===C?p.slice(I,D):p.slice(C,D),datasets:[{label:"wave height (feet)",data:0===C?m.slice(I,D):m.slice(C,D),pointStyle:!1,minBarLength:.1}]},options:{onHover:S,borderRadius:5,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:{backgroundColor:e=>(e=>g[e.dataIndex+C])(e)||"#4ade80"}},responsive:!0,interaction:{intersect:!1,axis:"x"},scales:{x:{ticks:{callback:F}},y:{beginAtZero:!0,max:h,ticks:{callback:function(e,t,a){return e%2!=0?"":e},font:P}}}}});function R(e){t("forecast-range",e)}function N(){if(0===C){let e=c>20&&(new Date).getHours()>20;R(24===M?e?"Tomorrow":"Today":e?`Tomorrow - ${p[C+25].split(" ")[0]}`:"Today - Tomorrow")}else if(24===M)R(p[C].split(" ")[0]);else{const e=p[D-1]??p[p.length-1];R(`${p[C].split(" ")[0]} - ${e.split(" ")[0]}`)}}function O(){const e=0===C?I:C;let t=p.slice(e,D);H.data.labels=t,H.data.datasets[0].data=m.slice(e,D),H.update(),V.data.labels=t,V.data.datasets[0].data=x.slice(e,D),V.update(),G.data.labels=t,G.data.datasets[0].data=E.slice(e,D),G.update()}N(),window.addEventListener("resize",(()=>{M=L(),C+M>p.length?(D=p.length,C=p.length-M):D=C+M,O(),B(0),0===C&&(e(document.getElementById("forecast-backward")).disabled=!0),C+M<m.length&&(e(document.getElementById("forecast-foreward")).disabled=!1),C+M>=m.length&&(e(document.getElementById("forecast-foreward")).disabled=!0),C>0&&(e(document.getElementById("forecast-backward")).disabled=!1),N()})),document.getElementById("forecast-backward")?.addEventListener("click",(()=>{C-M<0?(C=0,D=M):(D-=M,C-=M),O(),B(0===C?u:0),0===C&&(e(document.getElementById("forecast-backward")).disabled=!0),C+M<m.length&&(e(document.getElementById("forecast-foreward")).disabled=!1),N()})),document.getElementById("forecast-foreward")?.addEventListener("click",(()=>{D+M>p.length?(D=p.length,C=D-M):(C+=M,D+=M),O(),B(0),C+M>=m.length&&(e(document.getElementById("forecast-foreward")).disabled=!0),C>0&&(e(document.getElementById("forecast-backward")).disabled=!1),N()}));const W=(e,t,a,n)=>({type:"bar",plugins:[T],data:{labels:0===C?p.slice(I,D):p.slice(C,D),datasets:[{label:a,data:e,pointStyle:!1,minBarLength:.1}]},options:{stacked:!0,onHover:S,maintainAspectRatio:!1,borderRadius:5,plugins:{legend:{display:!1},tooltip:{enabled:!1}},elements:{bar:t?{backgroundColor:t,borderColor:t}:{}},responsive:!0,interaction:{intersect:!1,axis:"x"},scales:{x:{ticks:{callback:F}},y:{beginAtZero:!0,max:n,ticks:{font:P}}}}}),J=document.getElementById("temperature-forecast"),V=new Chart(J,W(0===C?x.slice(I,D):x.slice(C,D),"pink","F",null)),z=document.getElementById("precipitation-forecast"),G=new Chart(z,W(0===C?E.slice(I,D):E.slice(C,D),null,"%",100));function Z(e){const t=H.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,a=t[0].index;V.tooltip.setActiveElements([{datasetIndex:e,index:a}]),V.setActiveElements([{datasetIndex:e,index:a}]),V.update(),G.tooltip.setActiveElements([{datasetIndex:e,index:a}]),G.setActiveElements([{datasetIndex:e,index:a}]),G.update()}else V.tooltip.setActiveElements([],{x:0,y:0}),V.setActiveElements([],{x:0,y:0}),V.update(),G.tooltip.setActiveElements([],{x:0,y:0}),G.setActiveElements([],{x:0,y:0}),G.update()}function U(e){const t=V.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,a=t[0].index;H.tooltip.setActiveElements([{datasetIndex:e,index:a}]),H.setActiveElements([{datasetIndex:e,index:a}]),H.update(),G.tooltip.setActiveElements([{datasetIndex:e,index:a}]),G.setActiveElements([{datasetIndex:e,index:a}]),G.update()}else H.tooltip.setActiveElements([],{x:0,y:0}),H.setActiveElements([],{x:0,y:0}),H.update(),G.tooltip.setActiveElements([],{x:0,y:0}),G.setActiveElements([],{x:0,y:0}),G.update()}function j(e){const t=G.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,a=t[0].index;V.tooltip.setActiveElements([{datasetIndex:e,index:a}]),V.setActiveElements([{datasetIndex:e,index:a}]),V.update(),H.tooltip.setActiveElements([{datasetIndex:e,index:a}]),H.setActiveElements([{datasetIndex:e,index:a}]),H.update()}else V.tooltip.setActiveElements([],{x:0,y:0}),V.setActiveElements([],{x:0,y:0}),V.update(),H.tooltip.setActiveElements([],{x:0,y:0}),H.setActiveElements([],{x:0,y:0}),H.update()}H.canvas.onmousemove=Z,V.canvas.onmousemove=U,G.canvas.onmousemove=j,H.canvas.ontouchmove=Z,V.canvas.ontouchmove=U,G.canvas.ontouchmove=j}}();
