!function(){"use strict";function e(e){if(null==e)throw"item is null or undefined";return e}function t(e){if(null==e)throw"item is null or undefined";if(e instanceof HTMLButtonElement)return e;throw"item is not a button"}function n(e,t){e instanceof Array?e.forEach((e=>a(e,t))):a(e,t)}function a(t,n){e(document.getElementById(t)).innerText=n}function i(e,t,n){document.getElementById(e)?.setAttribute(t,n)}function o(e,t){e instanceof Array?e.forEach((e=>{i(e,"style",t)})):i(e,"style",t)}function r(e){document.querySelectorAll(e).forEach((e=>e.remove()))}function l(e){document.getElementById(e)?.remove()}function s(e,t){document.getElementById(e)?.classList.remove(t)}function c(e){s(e,"hidden")}function d(t,n){e(document.getElementById(t)).innerHTML=n}function u(e){document.getElementById(e).innerHTML+='<svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">\n                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />\n              </svg>'}function g(e){o(e,"background-color: #facc15; color: #000; display: flex; align-items: center; flex-direction: row-reverse; gap: 8px"),e instanceof Array?e.forEach((e=>{u(e)})):u(e)}const f="#a8a29e",m={"#0bd674":"Good","#ffcd1e":"Fair to Good","#ff9500":"Poor","#f4496d":"Very Poor","#a8a29e":"Flat"};let p,w,v,h,y,x,b,_,E,A,I,q;function $(e){const a=new Date(e.starting_at).getHours();let i=new Date(e.starting_at).getHours();if(a>20){let t=24-a;const n=e.wave_height_labels.length-(e.wave_height_labels.length-t)%24;i=0,w=e.wave_height_labels.slice(t,n),p=e.quality.slice(t,n),v=e.wave_height.slice(t,n),h=e.wind_speed.slice(t,n),y=e.wind_direction.slice(t,n),x=e.wind_gust.slice(t,n),b=e.wave_period.slice(t,n),_=e.temperature.slice(t,n),E=e.dewpoint.slice(t,n),A=e.cloud_cover.slice(t,n),I=e.probability_of_precipitation.slice(t,n),q=e.probability_of_thunder.slice(t,n)}else{const t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][new Date(e.starting_at).getDay()],n=[];for(let e=0;e<a;e++)0!==e?(e<10&&n.push(`${t} 0${e} AM`),e>=10&&e<12&&n.push(`${t} ${e} AM`),12===e&&n.push(`${t} ${e} PM`),e>12&&n.push(`${t} 0${e-12} PM`)):n.push(`${t} 12 AM`);const i=e.wave_height_labels.length+a-(e.wave_height_labels.length+a)%24;w=n.concat(e.wave_height_labels).slice(0,i),p=new Array(a).fill("#a8a29e").concat(e.quality).slice(0,i),v=new Array(a).fill(0).concat(e.wave_height).slice(0,i),h=new Array(a).fill(0).concat(e.wind_speed).slice(0,i),y=new Array(a).fill(0).concat(e.wind_direction).slice(0,i),x=new Array(a).fill(0).concat(e.wind_gust).slice(0,i),b=new Array(a).fill(0).concat(e.wave_period).slice(0,i),_=new Array(a).fill(0).concat(e.temperature).slice(0,i),E=new Array(a).fill(0).concat(e.dewpoint).slice(0,i),A=new Array(a).fill(0).concat(e.cloud_cover).slice(0,i),I=new Array(a).fill(0).concat(e.probability_of_precipitation).slice(0,i),q=new Array(a).fill(0).concat(e.probability_of_thunder).slice(0,i)}let d=(new Date).getHours();const u=document.getElementById("current-wave-height");""===u?.innerText&&(u.innerText=e.current_wave_height,"0"==e.current_wave_height&&(o("wave-quality",`background-color: ${f}`),n("wave-quality-text",m[f]),o("wave-quality-text",`color: ${f}`),r(".wave-quality-loader")),o("wave-icon",`transform: rotate(${e.current_wave_direction}deg);`),r(".wavey"));const $=document.getElementById("current-wave-period");""===$?.innerText&&($.innerText=e.current_wave_period,l("wavey-period-loader")),n("legend-label",w[d]),n("legend-quality",m[p[d]]),n("legend-wave-height",v[d]),n("legend-wind-speed",h[d]),o("legend-wind-icon",`transform: rotate(${y[d]+180}deg);`),n("legend-wave-period",b[d]),n("legend-wind-gust",x[d]),n("forecast-as-of",`Updated ${e.as_of}`),n("forecast-as-of-2",`Updated ${e.as_of}`);new Date(e.as_of)<new Date-864e5&&g(["forecast-as-of-container-2","forecast-as-of-container"]),r(".forecast-loader"),c("forecast"),c("wave-quality"),c("legend-container"),s("forecast-as-of-container","animate-pulse"),s("forecast-as-of-container-2","animate-pulse"),c("temperature-legend-container"),n("temperature-legend-label",w[d]),n("temperature-legend-temperature",_[d]),n("temperature-legend-dewpoint",E[d]),c("precipitation-legend-container"),n("precipitation-legend-label",w[d]),n("precipitation-legend-precipitation",I[d]),n("precipitation-legend-thunder",q[d]),n("precipitation-legend-cloud-cover",A[d]),o("legend",`background-color: ${p[d]};`),o(["legend-container","precipitation-legend-container","temperature-legend-container"],"margin-top: 1rem;");const B={id:"vert",defaults:{width:1,dash:[3,3]},afterInit:(e,t,n)=>{e.corsair={x:0,y:0}},afterDraw:(e,t,n)=>{if(e.tooltip?._active?.length){let t=e.tooltip._active[0].element.x,a=e.scales.y,i=e.ctx;i.save(),i.beginPath(),i.moveTo(t,a.top),i.lineTo(t,a.bottom),i.lineWidth=1,i.setLineDash(n.dash),i.strokeStyle="#fff",i.stroke(),i.restore()}if(d-i>C){const t=e.ctx,n=e.scales.x.getPixelForValue(d-i);t.save(),t.strokeStyle="#5b5b58",t.lineWidth=1,t.beginPath(),t.moveTo(n,0),t.lineTo(n,e.height),t.stroke(),t.fillStyle="#5b5b58",t.font="bold 1rem ui-sans-serif, system-ui, sans-serif",t.fillText("Now",d>14&&24===D?n-45:n+5,15),t.restore()}}};function k(e){let t;t=0===C?w.length-a-1<=e?w.length-a-1:e:e>=w.length-a?w.length-a-1:e;T(t+(0===C?i:C))}function T(e){const t=p[e];o("legend",`background-color: ${t}`),n("legend-label",w[e]),n("legend-quality",m[t]),n("legend-wave-height",v[e]),n("legend-wind-speed",h[e]),o("legend-wind-icon",`transform: rotate(${y[e]+180}deg);`),n("legend-wave-period",b[e]),n("legend-wind-gust",x[e]),n("temperature-legend-label",w[e]),n("temperature-legend-temperature",_[e]),n("temperature-legend-dewpoint",E[e]),n("precipitation-legend-label",w[e]),n("precipitation-legend-precipitation",I[e]),n("precipitation-legend-thunder",q[e]),n("precipitation-legend-cloud-cover",A[e])}const M=(e,t,n)=>{const a=Chart.helpers.getRelativePosition(e,n),i=function(e){return 24===D||48===D?e&&e>0?e>=v.length-C?v.length-C-1:e:0:e&&e>0?e>=v.length?v.length-1:e:0}(n.scales.x.getValueForPixel(a.x));k(i)},L=(e,t)=>{const n=0===C?i:C;return 24===D?t%6==0?w[t+n]:null:48===D?t%8==0?w[t+n]:null:t%24==0?w[t+n]:null};const S=()=>window.innerWidth<768?24:window.innerWidth<1024?48:v.length;let D=S(),C=0,F=C+D;const H={weight:"semi-bold"},P=e=>({aspectRatio:1.75,onHover:M,borderRadius:5,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!1}},responsive:!0,interaction:{intersect:!1,axis:"x"},scales:{x:{ticks:{callback:L}},y:{grid:{color:"#1B1B1B"},beginAtZero:!0,max:e??10,ticks:{callback:e=>1&e?null:e,font:H}}}});let N=v.reduce(((e,t)=>t>e?Math.ceil(t):e),10);1&N&&N++;const W=new Chart(document.getElementById("forecast"),{type:"bar",plugins:[B],data:{labels:0===C?w.slice(i,F):w.slice(C,F),datasets:[{label:"wave height (feet)",data:0===C?v.slice(i,F):v.slice(C,F),pointStyle:!1,minBarLength:.1}]},options:{...P(N),elements:{bar:{backgroundColor:e=>(e=>0===C?p[e.dataIndex+i]:p[e.dataIndex+C])(e)||"#4ade80"}}}});function O(e){n("forecast-range",e)}function R(){if(0===C){let e=a>20&&(new Date).getHours()>20;O(24===D?e?"Tomorrow":"Today":e?`Tomorrow - ${w[C+25].split(" ")[0]}`:"Today - Tomorrow")}else if(24===D)O(w[C].split(" ")[0]);else{const e=w[F-1]??w[w.length-1];O(`${w[C].split(" ")[0]} - ${e.split(" ")[0]}`)}}function j(){const e=0===C?i:C;let t=w.slice(e,F);W.data.labels=t,W.data.datasets[0].data=v.slice(e,F),W.update(),V.data.labels=t,V.data.datasets[0].data=_.slice(e,F),V.update(),G.data.labels=t,G.data.datasets[0].data=I.slice(e,F),G.update()}R(),window.addEventListener("resize",(()=>{D=S(),C+D>w.length?(F=w.length,C=w.length-D):F=C+D,j(),k(0),0===C&&(t(document.getElementById("forecast-backward")).disabled=!0),C+D<v.length&&(t(document.getElementById("forecast-foreward")).disabled=!1),C+D>=v.length&&(t(document.getElementById("forecast-foreward")).disabled=!0),C>0&&(t(document.getElementById("forecast-backward")).disabled=!1),R()})),document.getElementById("forecast-backward")?.addEventListener("click",(()=>{C-D<0?(C=0,F=D):(F-=D,C-=D),j(),0===C?T(d):k(0),0===C&&(t(document.getElementById("forecast-backward")).disabled=!0),C+D<v.length&&(t(document.getElementById("forecast-foreward")).disabled=!1),R()})),document.getElementById("forecast-foreward")?.addEventListener("click",(()=>{F+D>w.length?(F=w.length,C=F-D):(C+=D,F+=D),j(),k(0),C+D>=v.length&&(t(document.getElementById("forecast-foreward")).disabled=!0),C>0&&(t(document.getElementById("forecast-backward")).disabled=!1),R()}));const J=(e,t,n)=>({type:"bar",plugins:[B],data:{labels:0===C?w.slice(i,F):w.slice(C,F),datasets:[{label:n,data:e,pointStyle:!1,minBarLength:.1}]},options:{...P(100),elements:{bar:t?{backgroundColor:t,borderColor:t}:{}}}}),U=document.getElementById("temperature-forecast"),V=new Chart(U,J(0===C?_.slice(i,F):_.slice(C,F),"pink","F")),Z=document.getElementById("precipitation-forecast"),G=new Chart(Z,J(0===C?I.slice(i,F):I.slice(C,F),null,"%"));function z(e){const t=W.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,n=t[0].index;V.tooltip.setActiveElements([{datasetIndex:e,index:n}]),V.setActiveElements([{datasetIndex:e,index:n}]),V.update(),G.tooltip.setActiveElements([{datasetIndex:e,index:n}]),G.setActiveElements([{datasetIndex:e,index:n}]),G.update()}else V.tooltip.setActiveElements([],{x:0,y:0}),V.setActiveElements([],{x:0,y:0}),V.update(),G.tooltip.setActiveElements([],{x:0,y:0}),G.setActiveElements([],{x:0,y:0}),G.update()}function K(e){const t=V.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,n=t[0].index;W.tooltip.setActiveElements([{datasetIndex:e,index:n}]),W.setActiveElements([{datasetIndex:e,index:n}]),W.update(),G.tooltip.setActiveElements([{datasetIndex:e,index:n}]),G.setActiveElements([{datasetIndex:e,index:n}]),G.update()}else W.tooltip.setActiveElements([],{x:0,y:0}),W.setActiveElements([],{x:0,y:0}),W.update(),G.tooltip.setActiveElements([],{x:0,y:0}),G.setActiveElements([],{x:0,y:0}),G.update()}function Q(e){const t=G.getElementsAtEventForMode(e,"nearest",{axis:"x",intersect:!1},!0);if(t[0]){const e=t[0].datasetIndex,n=t[0].index;V.tooltip.setActiveElements([{datasetIndex:e,index:n}]),V.setActiveElements([{datasetIndex:e,index:n}]),V.update(),W.tooltip.setActiveElements([{datasetIndex:e,index:n}]),W.setActiveElements([{datasetIndex:e,index:n}]),W.update()}else V.tooltip.setActiveElements([],{x:0,y:0}),V.setActiveElements([],{x:0,y:0}),V.update(),W.tooltip.setActiveElements([],{x:0,y:0}),W.setActiveElements([],{x:0,y:0}),W.update()}W.canvas.onmousemove=z,V.canvas.onmousemove=K,G.canvas.onmousemove=Q,W.canvas.ontouchmove=z,V.canvas.ontouchmove=K,G.canvas.ontouchmove=Q}function B(t){t.wave_height&&(n("current-wave-height",t.wave_height),o("wave-icon",`transform: rotate(${t.wave_direction}deg);`),r(".wavey")),t.wave_period&&(n("current-wave-period",t.wave_period),l("wavey-period-loader")),(""===e(document.getElementById("wave-quality-text")).innerText||t.wave_height||parseFloat(e(document.getElementById("current-wave-height")).innerText??"0")>=1)&&(o("wave-quality",`background-color: ${t.quality_color};`),n("wave-quality-text",t.quality_text),o("wave-quality-text",`color: ${t.quality_color}`),r(".wave-quality-loader")),n("current-water-temp",t.water_temp),n("current-air-temp",t.air_temp),n("current-air-temp-2",t.air_temp),n("wind",k(t)),n("as-of",`As of ${t.as_of}`),o("wind-icon",`transform: rotate(${t.wind_direction+180}deg);`),r(".latest-loader"),c("wind-icon-container"),c("wave-icon-container"),s("as-of-container","animate-pulse"),c("wave-quality"),t.loaded_from_fallback&&c("wave-fallback-icon");let a=new Date(t.as_of)<new Date-864e5;a&&(n("as-of","bouy/weather station down"),g("as-of-container")),t.loaded_from_fallback&&a&&(n("wind","---"),o("wind-icon-container","display: none;"),n("wind-measurement","unavailable"),n(["current-air-temp-2-measurement","current-air-temp-measurement"],"unavailable"),n(["current-air-temp-2","current-air-temp"],"---"))}const k=e=>e.wind_speed===e.gusts||"0"===e.gusts?e.wind_speed:`${e.wind_speed}-${e.gusts}`;const T=e(document.querySelector("body"));function M(){const e=document.getElementById("forecast-data");try{$(JSON.parse(e.innerText))}catch(e){!function(e){l("forecast-container"),d("forecast-error",`\n    <div class="p-12 flex flex-col items-center align-middle justify-center text-center">\n      <h2 class="text-xl font-mono">\n      Error loading forecast data - please refresh the page or try again later.\n      </h2>\n      <p>${e}</p>\n    </div>\n    `)}(e)}}new MutationObserver((async e=>{["latest","forecast","water-quality"].forEach((e=>{var t;t=e,setTimeout((()=>{document.querySelectorAll(`.${t}-loader`).length>0&&d(`${t}-container`,`<div class="p-12 flex flex-col items-center align-middle justify-center text-center">\n<h2 class="text-xl font-mono">\nError loading ${t} data - please refresh the page or try again later.\n</h2>\n<p>Server timed out.</p>\n</div>`)}),2e4)}));for(const a of e)if(a.target instanceof HTMLElement){"realtime-data"===a.target.id&&B(JSON.parse(a.target.innerText)),"water-quality-data"===a.target.id&&(t=JSON.parse(a.target.innerText),r(".water-quality-loader"),c("current-water-quality"),n("current-water-quality-title","Closed for season"===t.water_quality?"-----":t.water_quality.toUpperCase()),n("current-water-quality-status-text",t.water_quality_text),"Advisory"===t.water_quality&&o("current-water-quality-title","color: #facc15;"),"Closed"===t.water_quality&&o("current-water-quality-title","color: #ef4444;"));for(let e=0;e<a.addedNodes.length;e++)"forecast-complete"===a.addedNodes[e].id&&M()}var t})).observe(T,{attributes:!0,childList:!0,subtree:!0})}();
