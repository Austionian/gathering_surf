<!doctype html>
<html lang="en">
  <head>
    <title>Gathering Surf - {{ spot.name }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <meta charset="utf-8" />
    <meta name="description" content="Lake Michigan surf forecasts" />
    <meta name="theme-color" content="#02050e" />

    <link rel="preload" href="/assets/styles.css?version=54" as="style" />
    <link
      rel="preload"
      href="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"
      as="script"
    />
    <link
      rel="preload"
      href="/assets/static/index.min.js?version=57"
      as="script"
    />

    <link
      href="/assets/styles.css?version=54"
      rel="stylesheet"
      type="text/css"
    />
    <style>
      [x-cloak] {
        display: none !important;
      }
    </style>
  </head>
  <body
    class="h-full bg-black"
    x-data="{ showNav: false, showLiveFeed: false }"
    @keyup.escape="showLiveFeed = false; showNav = false;"
    :class="{ 'overflow-hidden': showNav || showLiveFeed }"
  >
    <script src="/assets/static/index.min.js?version=57"></script>
    {% block body %} {% endblock %} {% include "includes/footer.html" %} {% if
    live_reload %}
    <script>
      function connect(reload = false) {
        const socket = new WebSocket("ws://localhost:8080/watch");

        socket.onopen = () => {
            if (reload) location.reload()
        }

        // Reload when a message arrives, meaning a template has been updated.
        // Wait 50 ms for assets to be re-compilied.
        socket.onmessage = () => {
          setTimeout(() => location.reload(), 50);
        };

        // Reload when the connection closes, meaning the server has changed and the
        // connection was lost.
        socket.onclose = () => {
          setTimeout(() => {
            console.log("socket reconnecting...");
            connect(true);
          }, 1_000);
        };
      }

      connect();
    </script>
    {% endif %}
  </body>
</html>
